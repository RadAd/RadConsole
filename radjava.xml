<project name="RadJava" basedir="." default="build">

    <property name="project.displayname"  value="${ant.project.name}"/>
    <property name="project.vendor"       value="RadSoft"/>
    
    <property name="executable.javac"       location="D:\Utils\Devel\jdk1.7_x86\bin\javac"/>
    
    <property name="src.dir"     value="src"/>
    <property name="classes.dir" value="classes"/>
    <property name="bin.dir"     value="bin"/>
    <property name="libs.dir"    value="libs"/>
    <property name="assets.dir"  value="assets"/>
    
    <property name="jar.name"    value="${bin.dir}/${ant.project.name}.jar"/>

    <path id="build.classpath">
        <fileset dir="${libs.dir}" includes="*.jar"/>
    </path>
    
    <path id="manifest.classpath">
        <fileset dir="${bin.dir}" includes="*.jar">
            <exclude name="${ant.project.name}.jar"/>
        </fileset>
    </path>
    
    <target name="clean">
        <delete dir="${classes.dir}"/>
    </target>

    <target name="realclean" depends="clean">
        <delete dir="${bin.dir}"/>
    </target>

    <target name="compile" description="compile the source">
        <mkdir dir="${classes.dir}"/>
        <tstamp/>
        <javac
            srcdir="${src.dir}"
            destdir="${classes.dir}"
            includeantruntime="false"
            classpathref="build.classpath"
            executable="${executable.javac}"
            fork="true"/>
    </target>

    <target name="jar-pre">
        <mkdir dir="${bin.dir}"/>
        <copy todir="${bin.dir}" flatten="true">
            <path refid="build.classpath"/>
        </copy>
        <manifestclasspath property="jar.classpath" jarfile="${jar.name}">
            <classpath refid="manifest.classpath"/>
        </manifestclasspath>	
    </target>

    <target name="jar-main" if="project.mainclass">
        <jar destfile="${jar.name}" basedir="${classes.dir}">
            <fileset dir="${assets.dir}" erroronmissingdir="false"/>
            <manifest>
                <attribute name="Main-Class" value="${project.mainclass}"/>
                <attribute name="Class-Path" value="${jar.classpath}"/>
                <section name="${project.displayname}">
                  <attribute name="Specification-Title" value="${project.displayname}"/>
                  <attribute name="Specification-Version" value="${project.version}"/>
                  <attribute name="Specification-Vendor" value="${project.vendor}"/>
                  <attribute name="Implementation-Title" value="${project.displayname}"/>
                  <attribute name="Implementation-Version" value="${project.version} ${TODAY}"/> 
                  <attribute name="Implementation-Vendor" value="${project.vendor}"/>
                </section>
            </manifest>
        </jar>
    </target>

    <target name="jar-nomain" unless="project.mainclass">
        <jar destfile="${jar.name}" basedir="${classes.dir}">
            <fileset dir="${assets.dir}" erroronmissingdir="false"/>
            <manifest>
                <attribute name="Class-Path" value="${jar.classpath}"/>
                <attribute name="Specification-Title" value="${project.displayname}"/>
                <attribute name="Specification-Version" value="${project.version}"/>
                <attribute name="Specification-Vendor" value="${project.vendor}"/>
                <attribute name="Implementation-Title" value="${project.displayname}"/>
                <attribute name="Implementation-Version" value="${project.version} ${TODAY}"/> 
                <attribute name="Implementation-Vendor" value="${project.vendor}"/>
            </manifest>
        </jar>
    </target>

    <target name="jar" depends="compile,jar-pre,jar-main,jar-nomain" description="create the jar file">
    </target>

    <target name="build" depends="jar" description="build all targets">
    </target>

    <target name="show" depends="jar-pre">
        <echo message="Jar: ${jar.name}"/>
        <echo message="Classpath1: ${toString:build.classpath}"/>
        <echo message="Classpath2: ${toString:manifest.classpath}"/>
        <echo message="Classpath4: ${jar.classpath}"/>
    </target>

    <target name="run" depends="jar" description="execute the jar file">
        <java jar="${jar.name}" fork="true"/>
    </target>

    <target name="rebuild" depends="clean,build"/>
    
</project>
